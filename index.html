<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#1e3d6b">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <title>DIY Motion – Time Blocker</title>
  <meta name="description" content="Eigene Web-App für automatisches Time-Blocking (ohne Abo).">
  <style>
    :root {
      --bg:#0f172a; --bg-card:#111827; --bg-elev:#0b1220;
      --bd:#1f2937; --muted:#9ca3af; --muted2:#a1a1aa;
      --fg:#e5e7eb; --brand:#1d4ed8; --brand2:#1e3a8a;
      --chip:#0b1220; --chipbd:#334155;
      --task:#1e293b; --busy:#0f172a;
      --p1:#334155; --p2:#1e3a8a; --p3:#2563eb; --p4:#f59e0b; --p5:#ef4444;
    }
    *{ box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; background: var(--bg); color: var(--fg); }
    header { position: sticky; top: 0; background: rgba(15,23,42,0.9); backdrop-filter: blur(6px); border-bottom: 1px solid var(--bd); padding: 12px 16px; display: flex; gap: 12px; align-items: center; z-index: 20; }
    header h1 { font-size: 16px; margin: 0; letter-spacing: .3px; }
    main { padding: 16px; display: grid; gap: 16px; }
    .card { background: var(--bg-card); border: 1px solid var(--bd); border-radius: 12px; padding: 14px; }
    .row { display: grid; gap: 8px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 10px; }
    label { font-size: 12px; color: var(--muted2); }
    input, select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #30363d; background: var(--bg-elev); color: var(--fg); }
    input[type="checkbox"].switch { width:auto; }
    select[multiple]{ min-height: 88px; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #3b82f6; background: var(--brand); color: white; cursor: pointer; }
    button.secondary { background: var(--bg-elev); border-color: #475569; color: var(--fg); }
    .task { display: grid; grid-template-columns: 1fr auto; gap: 8px; padding: 10px; border: 1px dashed #374151; border-radius: 10px; }
    .muted { color: var(--muted); font-size: 12px; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin-left:auto; align-items:center; }
    .pill { display:inline-block; padding:3px 8px; border:1px solid var(--chipbd); border-radius:999px; font-size:11px; color:#cbd5e1; background:var(--chip); }
    .footer { text-align: center; color: #94a3b8; font-size: 12px; padding: 20px 0 40px; }
    /* Kalender */
    .kbar { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    .kbar .title { font-weight:600; }
    .cal-wrap { overflow: auto; background: var(--bg-elev); border:1px solid #263142; border-radius:12px; }
    .cal-day, .cal-week { position: relative; min-height: 900px; }
    .hours { position:absolute; left:0; top:0; bottom:0; width:48px; border-right:1px solid #233048; }
    .hours div { height: 60px; padding: 2px 6px; font-size: 11px; color: #94a3b8; }
    .cols { position:absolute; left:48px; right:0; top:0; bottom:0; display:grid; }
    .cols.day { grid-template-columns: 1fr; }
    .cols.week { grid-template-columns: repeat(7, 1fr); }
    .col { position:relative; border-right:1px dashed #24324a; }
    .col:last-child { border-right:0; }
    .gridline { position:absolute; left:0; right:0; height:1px; background:#1f2937; opacity:.6; }
    .event { position:absolute; border-radius:10px; border:1px solid #334155; background: var(--task); padding:6px 8px; font-size:12px; overflow:hidden; cursor:grab; }
    .event .t { font-weight:600; margin-bottom:2px; }
    .event.busy { background:var(--busy); border-style:dashed; opacity:.85; cursor:default; }
    .event.locked { outline: 2px solid #64748b; }
    .prio-1{ background:#0b1220; border-color:#334155; }
    .prio-2{ background:var(--p2); border-color:#1f3a8a; }
    .prio-3{ background:var(--p3); border-color:#1d4ed8; }
    .prio-4{ background:#7c3aed; border-color:#6d28d9; }
    .prio-5{ background:var(--p5); border-color:#b91c1c; }
    .weekday { position:sticky; top:0; background: rgba(11,18,32,.9); backdrop-filter: blur(6px); border-bottom:1px solid #1f2937; z-index:5; display:grid; grid-template-columns: 48px repeat(7,1fr); }
    .weekday div { padding:8px 6px; font-size:12px; color:#cbd5e1; text-align:center; }
    .weekday .sp { text-align:left; color:#94a3b8; }
    .backlog { position:absolute; left:54px; right:6px; top:4px; display:flex; gap:6px; flex-wrap:wrap; }
    .chip { padding:4px 8px; border:1px solid var(--chipbd); border-radius:999px; background:var(--chip); font-size:11px; white-space:nowrap; }
    .warn { color:#fef08a; }
    .crit { color:#fecaca; }
    .switchrow { display:flex; align-items:center; gap:8px; }
  </style>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>
</head>
<body>
  <header>
    <img src="icons/icon-192.png" alt="Logo" width="24" height="24">
    <h1>DIY Motion – Time Blocker</h1>
    <div class="controls">
      <span id="busyInfo" class="pill">Busy: 0</span>
      <label class="muted switchrow"><input id="autoReplan" type="checkbox" class="switch"> Auto-Replan</label>
      <button id="installBtn" class="secondary" hidden>Auf iPhone installieren</button>
      <button id="exportIcsBtn" class="secondary">ICS exportieren</button>
      <button id="resetBtn" class="secondary">Reset</button>
    </div>
  </header>
  <main>
    <section class="card">
      <h2 style="margin:0 0 8px">Kalender & Verfügbarkeit</h2>
      <div class="grid">
        <div class="row">
          <label>Google Calendar (nur lesen)</label>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <button id="gcAuth">Google verbinden</button>
            <button id="gcSync" class="secondary">Neu synchronisieren</button>
          </div>
          <p class="muted">Tasks bleiben <strong>nur in dieser App</strong>. Wir lesen Termine (Busy) und blocken diese Zeiten beim Planen.</p>
        </div>
        <div class="row">
          <label>ICS importieren (iCloud/Outlook/etc.)</label>
          <input id="icsFile" type="file" accept=".ics,text/calendar">
        </div>
      </div>
      <div id="busyPreview" class="muted"></div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 8px">Neue Aufgabe</h2>
      <div class="grid">
        <div class="row"><label for="title">Titel</label><input id="title" placeholder="z. B. Angebot für Kunde A"></div>
        <div class="row"><label for="duration">Dauer (Minuten)</label><input id="duration" type="number" min="5" step="5" value="60"></div>
        <div class="row"><label for="deadline">Deadline (optional)</label><input id="deadline" type="datetime-local"></div>
        <div class="row"><label for="hardDeadline"><input type="checkbox" id="hardDeadline" class="switch"> Harte Deadline</label></div>
        <div class="row"><label for="priority">Priorität</label>
          <select id="priority">
            <option value="1">Sehr niedrig</option>
            <option value="2">Niedrig</option>
            <option value="3" selected>Mittel</option>
            <option value="4">Hoch</option>
            <option value="5">Sehr hoch</option>
          </select>
        </div>
        <div class="row">
          <label>Nach (Task/Event)</label>
          <select id="afterSelect" multiple></select>
        </div>
        <div class="row">
          <label>Vor (Task/Event)</label>
          <select id="beforeSelect" multiple></select>
        </div>
      </div>
      <div style="margin-top:10px; display:flex; gap:8px;">
        <button id="addTask">Aufgabe in Inbox</button>
        <button id="plan">Jetzt einplanen</button>
      </div>
      <p class="muted">Workflow: Aufgabe → landet in der **Inbox**. <strong>Slider</strong> umlegen = aktiv → wird automatisch eingeplant.</p>
    </section>

    <section class="card">
      <h2 style="margin:0 0 8px">Aufgaben</h2>
      <div id="tasks"></div>
    </section>

    <section class="card">
      <div class="kbar">
        <div class="title" id="kTitle">Kalender</div>
        <span style="flex:1"></span>
        <button id="prev" class="secondary">‹</button>
        <button id="today" class="secondary">Heute</button>
        <button id="next" class="secondary">›</button>
        <button id="vDay">Tag</button>
        <button id="vWeek" class="secondary">Woche</button>
        <label style="display:flex; align-items:center; gap:6px; margin-left:8px;" class="muted">
          <input type="checkbox" id="toggleBusy" checked> Busy anzeigen
        </label>
      </div>
      <div class="cal-wrap">
        <div id="weekday" class="weekday" style="display:none"></div>
        <div id="calendar" class="cal-day">
          <div class="hours" id="hours"></div>
          <div class="cols day" id="cols"></div>
          <div id="backlog" class="backlog"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 8px">Liste (Text)</h2>
      <div id="schedule"></div>
    </section>

    <div class="footer">
      Offline-fähig. Als App installierbar. Kalender: Tages- & Wochenansicht, Inbox, Auto-Replan, Drag&Drop.
    </div>
  </main>

  <script src="app.js"></script>
</body>
</html>
